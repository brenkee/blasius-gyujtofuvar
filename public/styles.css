:root{
  --bg:#fafafa; --panel:#fff; --border:#e5e7eb; --text:#111827; --muted:#6b7280;
  --accent:#2563eb; --ok:#16a34a; --err:#dc2626; --highlight:#e0f2fe;
  --panel-min:330px; --panel-pref:36vw; --panel-max:520px;
  --mobile-header-height:0px;
}
:root.dark{
  --bg:#0f172a; --panel:#0b1220; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
  --accent:#60a5fa; --ok:#34d399; --err:#f87171; --highlight:#1e293b;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}
body.import-busy{overflow:hidden}
body.import-busy .app{filter:blur(4px);pointer-events:none;user-select:none}
.auth-body{background:var(--bg);margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center}
.auth-page{width:100%;max-width:480px;padding:24px}
.auth-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:32px 28px;box-shadow:0 20px 50px rgba(15,23,42,0.18);display:grid;gap:18px}
.auth-card h1{margin:0;font-size:24px;text-align:center;color:var(--text)}
.auth-logo{display:block;margin:0 auto 12px;width:auto;max-height:72px}
.auth-subtitle{margin:0;text-align:center;color:var(--muted);font-size:15px}
.auth-form{display:grid;gap:16px}
.auth-form label{display:grid;gap:6px;font-size:14px;color:var(--muted)}
.auth-form input[type="text"],.auth-form input[type="password"],.auth-form input[type="email"]{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--panel);color:var(--text);font-size:16px}
.auth-form input:focus{outline:2px solid var(--accent);outline-offset:2px}
.auth-submit{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:12px;font-size:16px;font-weight:600;cursor:pointer;transition:background .2s ease}
.auth-submit:hover{background:#1d4ed8}
.auth-error{background:rgba(220,38,38,0.12);border:1px solid rgba(220,38,38,0.3);color:#7f1d1d;border-radius:10px;padding:10px 12px}
.auth-info{background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.35);color:#14532d;border-radius:10px;padding:10px 12px}
.auth-link{color:var(--accent);text-decoration:none;font-weight:600;display:block;text-align:center;margin-top:6px}
.auth-link:hover{text-decoration:underline}
.auth-forgot{display:grid;gap:12px;margin-top:8px}
.auth-forgot-toggle{background:none;border:none;color:inherit;padding:0;font:inherit;cursor:pointer}
.auth-forgot-section{gap:12px}
.auth-forgot-section hr{border:none;border-top:1px solid var(--border);margin:0}
.auth-forgot-section h2{margin:0;font-size:16px;text-align:center;color:var(--muted)}
.auth-submit-secondary{background:var(--border);color:var(--text)}
.auth-submit-secondary:hover{background:var(--muted);color:#fff}
@media (max-width:600px){.auth-card{padding:24px 20px}}
.init-error-banner{background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;border-radius:12px;padding:14px 18px;margin:12px auto;max-width:920px;box-shadow:0 8px 20px rgba(220,38,38,0.18)}
.init-error-banner strong{display:block;font-size:16px;margin-bottom:6px}
.init-error-banner code{background:rgba(127,29,29,0.12);color:inherit;padding:2px 6px;border-radius:6px;font-size:14px}
.app{display:grid;grid-template-columns:clamp(var(--panel-min),var(--panel-pref),var(--panel-max)) 1fr;grid-template-rows:minmax(0,1fr);min-height:100vh;max-width:100vw}
@media (min-width:1101px){
  .app{height:100vh}
  .panel{height:100vh;overflow-y:auto}
}
@media (max-width:1100px){
  .app{grid-template-columns:1fr;grid-template-rows:auto minmax(0,1fr)}
  .panel{grid-row:1/2}
  .panel-top{padding:14px 14px 10px}
  .panel-content{flex:1 1 auto}
  #map{grid-row:2/3;min-height:240px}
  .app[data-mobile-view="list"] #map{display:none}
  .app[data-mobile-view="list"] .panel{grid-row:1/3}
  .app[data-mobile-view="map"] .panel{overflow:visible;height:auto}
  .app[data-mobile-view="map"] .panel-content{display:none}
}

.btn-primary{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:600;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:6px;transition:filter .2s ease,transform .2s ease}
.btn-primary:hover{filter:brightness(.95)}
.btn-secondary{border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:10px;padding:10px 16px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:6px;cursor:pointer;transition:border-color .2s ease,color .2s ease}
.btn-secondary:hover{border-color:var(--accent);color:var(--accent)}

.log-page{max-width:1100px;margin:28px auto 48px;padding:0 16px 24px;display:grid;gap:24px}
.log-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap}
.log-header h1{margin:0;font-size:28px}
.log-subtitle{margin:6px 0 0;color:var(--muted);font-size:15px}
.log-back{color:var(--accent);text-decoration:none;font-weight:600}
.log-back:hover{text-decoration:underline}
.log-filters{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;display:flex;flex-wrap:wrap;gap:16px;align-items:flex-end;box-shadow:0 12px 32px rgba(15,23,42,0.08)}
.log-filter-group{display:flex;flex-direction:column;gap:6px;min-width:160px}
.log-filter-group label{font-size:13px;color:var(--muted);display:flex;flex-direction:column;gap:6px}
.log-filter-group input,.log-filter-group select{padding:9px 12px;border:1px solid var(--border);border-radius:10px;background:var(--panel);color:var(--text);font-size:14px;min-width:160px}
.log-filter-group input:focus,.log-filter-group select:focus{outline:2px solid var(--accent);outline-offset:2px}
.log-filter-actions{display:flex;gap:12px;flex-wrap:wrap;margin-left:auto}
.log-summary{display:flex;gap:18px;font-size:14px;color:var(--muted)}
.log-entries{display:grid;gap:16px}
.log-entry{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:18px 20px;display:grid;gap:14px;box-shadow:0 18px 38px rgba(15,23,42,0.08)}
.log-entry-header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.log-entry-header time{font-weight:600;color:var(--text)}
.log-entry-action{background:rgba(37,99,235,0.12);color:var(--accent);padding:6px 14px;border-radius:999px;font-size:13px;font-weight:600}
:root.dark .log-entry-action{background:rgba(96,165,250,0.18)}
.log-entry-message{margin:0;font-size:15px;line-height:1.55}
.log-entry-meta{display:flex;gap:16px;flex-wrap:wrap;font-size:13px;color:var(--muted)}
.log-empty{margin:0;padding:28px;border-radius:14px;border:1px dashed var(--border);background:var(--panel);text-align:center;color:var(--muted)}
.log-pagination{display:flex;gap:10px;flex-wrap:wrap}
.log-page-link{border:1px solid var(--border);border-radius:10px;padding:8px 14px;text-decoration:none;font-weight:600;color:var(--text)}
.log-page-link:hover{border-color:var(--accent);color:var(--accent)}
.log-page-link.is-active{background:var(--accent);color:#fff;border-color:var(--accent)}
@media (max-width:720px){
  .log-header{flex-direction:column;align-items:flex-start}
  .log-filter-actions{margin-left:0}
  .log-filter-group{min-width:100%}
  .log-filter-group input,.log-filter-group select{width:100%}
}
@media (max-width:768px){
  .panel-top-header{flex-wrap:nowrap;gap:12px}
  .panel-title{font-size:16px !important}
  .panel{width:100%;overflow-x:hidden}
  .app[data-mobile-view="list"] .panel{max-width:100vw}
  .toolbar{flex-wrap:nowrap;gap:6px}
  .app[data-mobile-view="map"] .panel{position:relative;z-index:60}
  .app[data-mobile-view="map"] .panel-top{position:sticky;top:0;z-index:80}
  .app[data-mobile-view="list"] .panel-content,
  .app[data-mobile-view="list"] .row{max-width:100%;width:100%}
  .group-controls{flex-wrap:wrap;gap:10px}
  .group-planned-date,
  .group-planned-time,
  .group-sort{width:100%;flex-wrap:wrap;gap:6px}
  .group-planned-date input,
  .group-planned-time input,
  .group-sort select{ width: 95px !important;}
  .form-grid,
  .metrics-grid,
  .grid{grid-template-columns:1fr}
  .iconbtn {padding: 4px 5px !important;}
  .row .drag-cell {    width: 15px !important;    display: none;}
  .change-notice{ border-radius: 19px !important;    width: 96%;    padding: 21px 26px !important;    font-size: 20px;    text-align: center;}
  .change-notice__button{    font-size: 20px;    border-radius: 10px !important;    padding: 26px 14px !important;}
}

@media (max-width:768px){
  .app[data-mobile-view="list"] .panel-content{overflow:hidden}
  .app[data-mobile-view="list"] .groups{
    display:flex;
    flex-direction:row;
    gap:16px;
    padding:0 16px 16px;
    overflow-x:auto;
    overflow-y:hidden;
    align-items:flex-start;
    scroll-snap-type:x mandatory;
    scroll-padding:0 16px;
    scroll-behavior:smooth;
    -webkit-overflow-scrolling:touch;
    height:max(320px, calc(100dvh - var(--mobile-header-height) - 32px));
  }
  .app[data-mobile-view="list"] .group{
    flex:0 0 calc(100% - 32px);
    max-width:calc(100% - 32px);
    min-width:calc(100% - 32px);
    scroll-snap-align:start;
    scroll-snap-stop:always;
    height:100%;
    display:flex;
    flex-direction:column;
    align-self:stretch;
  }
  .app[data-mobile-view="list"] .group-header{flex:0 0 auto}
  .app[data-mobile-view="list"] .group-body{
    flex:1 1 auto;
    min-height:0;
    overflow-y:auto;
  }
}

@media (max-width:1230px){
  .toolbar-pin-counter-label{display:none !important}}
  
.panel{background:var(--panel);border-right:1px solid var(--border);padding:0px;overflow:auto;max-width:100%;display:flex;flex-direction:column}
.panel-top{position:relative;margin-bottom:12px;padding:18px 18px 12px;display:grid;gap:12px;border-bottom:1px solid var(--border)}
.panel-top.sticky{position:sticky;top:0;background:var(--panel);z-index:5;padding:12px;box-shadow:0 14px 28px rgba(15,23,42,0.12)}
.panel-content{display:flex;flex-direction:column;flex:1 1 auto;min-height:0}
h1{font-size:18px;margin:0 0 6px}
.panel-top-header{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.panel-brand{display:flex;align-items:center;gap:12px;min-width:0;flex:1 1 auto}
.panel-title{margin:0;font-size:20px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.panel-brand-logo,.panel-title-image{max-height:48px;width:auto;display:block}
.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:0;margin-left:auto;justify-content:flex-end}
.toolbar button{height:40px !important}
.toolbar-pin-counter{font-weight:600;color:var(--muted);display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
.toolbar-pin-counter-label{display:inline-flex;align-items:center;gap:4px}
.toolbar-menu-container{position:relative;margin-top: -3px;}
.toolbar-menu-toggle{display:inline-flex;align-items:center;justify-content:center;padding:8px;gap:0}
.toolbar-menu-toggle:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.hamburger-icon{display:inline-flex;flex-direction:column;justify-content:space-between;width:var(--menu-icon-width,20px);height:var(--menu-icon-height,14px)}
.hamburger-icon span{display:block;height:var(--menu-icon-bar-height,2px);background:var(--menu-icon-color,var(--text));border-radius:var(--menu-icon-bar-radius,2px);transition:background-color .2s ease}
.toolbar-menu{position:absolute;top:calc(100% + 6px);left:-140px;display:grid;gap:6px;padding:10px;background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:0 18px 36px rgba(15,23,42,0.18);min-width:180px;z-index:200}
.toolbar-menu[hidden]{display:none!important}
.toolbar-menu-separator{margin:4px 0 2px;border:none;border-top:1px solid var(--border)}
.toolbar-menu button{width:100%;text-align:left}
.toolbar-menu button:hover{background:rgba(148,163,184,0.12)}
.toolbar-menu a.toolbar-menu-link{display:block;padding:8px 10px;border: 1px solid #e5e7eb;border-radius:8px;text-decoration:none;color:inherit;font-size:14px}
.toolbar-menu a.toolbar-menu-link:hover{background:rgba(148,163,184,0.12)}
.toolbar-menu-form{margin:0}
.toolbar-menu-form button{padding:8px 10px;border-radius:8px;border: 1px solid #e5e7eb;background:#ffc7c7;text-align:left;font:inherit;color:inherit;cursor:pointer}
.toolbar-menu-form button:hover{background:#ffa0a0}
.toolbar-menu-form button:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.quick-search-wrapper{margin:8px 8px 4px;display:flex;flex-wrap:nowrap;align-items:stretch;width:100%;--qs-input-text-color:var(--text);--qs-input-bg-color:var(--panel);--qs-focus-input-bg-color:var(--panel);--qs-text-color:var(--muted);--qs-active-color:var(--accent);--qs-focus-ring:rgba(37,99,235,0.18);--qs-status-border:rgba(37,99,235,0.3);--qs-status-bg:rgba(37,99,235,0.08);--qs-status-color:var(--accent);--qs-status-empty-border:rgba(220,38,38,0.35);--qs-status-empty-bg:rgba(248,113,113,0.15);--qs-status-empty-color:var(--err)}
.panel-top .quick-search-wrapper{width:100%;margin:0}
:root.dark .quick-search-wrapper{--qs-input-bg-color:rgba(15,23,42,0.85);--qs-focus-input-bg-color:rgba(15,23,42,0.85);--qs-text-color:#94a3b8;--qs-focus-ring:rgba(96,165,250,0.26);--qs-status-border:rgba(96,165,250,0.35);--qs-status-bg:rgba(96,165,250,0.12);--qs-status-empty-border:rgba(248,113,113,0.4);--qs-status-empty-bg:rgba(248,113,113,0.2)}
.quick-search-form{font-size:.95rem;display:flex;gap:.5rem;align-items:center;width:100%;position:relative;isolation:isolate}
.quick-search-label{width:100%;padding:0 1.1em;height:40px;display:flex;align-items:center;position:relative}
.quick-search-fancy-bg{position:absolute;width:100%;inset:0;background:var(--qs-input-bg-color);border:1px solid var(--border);border-radius:8px;height:100%;z-index:-1;pointer-events:none;box-shadow:rgba(15,23,42,0.06) 0 4px 12px;transition:border-color .2s ease,box-shadow .2s ease}
:root.dark .quick-search-fancy-bg{box-shadow:rgba(2,6,23,0.35) 0 6px 18px}
.quick-search-icon,.quick-search-close{position:absolute}
.quick-search-icon{fill:var(--qs-text-color);left:1.1em;display:flex;align-items:center;justify-content:center;transition:fill .2s ease}
.quick-search-icon svg{width:17px;height:17px;display:block}
.quick-search-input{color:var(--qs-input-text-color);width:100%;margin-inline:min(2.6em,calc(1.1em + 1.6rem));background:none;border:none;font:inherit}
.quick-search-input:focus{outline:none}
.quick-search-input::placeholder{color:var(--qs-text-color)}
.quick-search-close{border:1px solid var(--border);right:1.1em;box-sizing:border-box;display:flex;align-items:center;justify-content:center;color:var(--text);padding:0;width:28px;height:28px;border-radius:6px;background:var(--panel);opacity:0;visibility:hidden;transition:opacity .2s ease,visibility .2s ease,background-color .2s ease,border-color .2s ease;cursor:pointer}
.quick-search-close[data-theme="dark"]{color:var(--text)}
.quick-search-close svg{width:14px;height:14px}
.quick-search-close:hover{background:rgba(148,163,184,0.12)}
.quick-search-close:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.quick-search-wrapper.has-value .quick-search-close{opacity:1;visibility:visible}
.quick-search-form:focus-within .quick-search-fancy-bg,.quick-search-wrapper.has-filter .quick-search-fancy-bg{border-color:var(--qs-active-color);box-shadow:0 0 0 2px var(--qs-focus-ring)}
.quick-search-form:focus-within .quick-search-icon,.quick-search-wrapper.has-filter .quick-search-icon{fill:var(--qs-active-color)}
.quick-search-status{display:none;margin:0 8px 8px;padding:8px 12px;border-radius:16px;border:1px solid var(--qs-status-border);background:var(--qs-status-bg);color:var(--qs-status-color);font-size:12px;font-weight:600;transition:opacity .2s ease,transform .2s ease}
.quick-search-status.is-active{display:block}
.quick-search-status.is-empty{border-color:var(--qs-status-empty-border);background:var(--qs-status-empty-bg);color:var(--qs-status-empty-color);font-size:13px}
.view-switch{display:none;align-items:center;gap:8px;margin:0;padding:0 4px}
.view-switch[hidden]{display:none}
.view-switch-btn{appearance:none;border:1px solid var(--border);background:var(--panel);color:var(--muted);border-radius:8px;padding:10px;min-width:0;display:inline-flex;align-items:center;justify-content:center;width:42px;height:42px;cursor:pointer;transition:background .2s ease,color .2s ease,border-color .2s ease,box-shadow .2s ease;flex-shrink:0}
.view-switch-btn svg,
.view-switch-btn img{width:20px;height:20px;display:block}
.view-switch-btn:is(:hover,.is-active){color:var(--accent)}
.view-switch-btn.is-active{border-color:var(--accent);background:rgba(37,99,235,0.08);box-shadow:0 0 0 2px rgba(37,99,235,0.18)}
:root.dark .view-switch-btn.is-active{background:rgba(96,165,250,0.16);box-shadow:0 0 0 2px rgba(96,165,250,0.22)}
.view-switch-btn:focus-visible{outline:2px solid var(--accent);outline-offset:3px}
.visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.new-address-container{display:grid;gap:12px;margin-bottom:12px;padding: 8px;}
.new-address-container:empty{display:none}        
.new-address-container .warn, .new-address-container .title-city, .new-address-container .num, .new-address-container .del{display:none !important;}
.new-address-container .title-label.placeholder{color:green}
.groups{display:grid;gap:12px;padding: 8px;}
.group{border:1px solid var(--border);border-radius:12px;background:var(--panel)}
.group-header{display:flex;flex-direction:column;gap:8px;padding:10px;border-bottom:1px solid var(--border);background: #f0f2f5;}
.group-title{font-weight:800;display:flex;align-items:center;gap:6px;flex-wrap:wrap;cursor:pointer}
.group-title:focus{outline:2px solid rgba(37,99,235,0.6);outline-offset:2px}
.group-title .__sum{display: flex;flex: auto;justify-content: flex-end;}
.group-route-summary{display:none;padding:8px 12px;border-radius:8px;border-left:4px solid var(--route-color,rgba(37,99,235,0.6));background:rgba(37,99,235,0.08);color:#1f2937;font-size:13px;font-weight:600;line-height:1.35;flex-wrap:wrap;}
.group-route-summary:not([hidden]){display:flex;align-items:center;gap:8px;justify-content: space-around;}
:root.dark .group-route-summary{background:rgba(96,165,250,0.18);color:#e5e7eb;border-left-color:var(--route-color,rgba(96,165,250,0.65));}
.group-drag-indicator{display:none;font-size:14px;color:var(--muted);align-items:center;justify-content:center}
.group-controls{display:flex;flex-wrap:nowrap;gap:12px;align-items:center;justify-content: space-around;}
.group-tools{display:flex;gap:6px;flex-wrap:wrap;justify-content: space-around;}
.group-planned-date{display:flex;gap:8px;flex-wrap:nowrap;align-items:center}
.group-planned-date .planned-date-label{font-size:12px;font-weight:600;color:var(--muted);white-space:nowrap}
.group-planned-date input{width:110px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text);transition:background-color .3s ease,border-color .3s ease}
.planned-date-input.saved-flash{background:rgba(34,197,94,0.25);border-color:rgba(16,185,129,0.5)}
.group-planned-time{display:flex;gap:8px;flex-wrap:nowrap;align-items:center}
.group-planned-time .planned-time-label{font-size:12px;font-weight:600;color:var(--muted);white-space:nowrap}
.group-planned-time input{min-width:110px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text);transition:background-color .3s ease,border-color .3s ease}
.planned-time-input.saved-flash{background:rgba(34,197,94,0.25);border-color:rgba(16,185,129,0.5)}
.group-sort{display:flex;gap:8px;align-items:center}
.group-sort .sort-mode-label{font-size:12px;font-weight:600;color:var(--muted);white-space:nowrap}
.group-sort select{width:130px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text);transition:background-color .3s ease,border-color .3s ease}
.group-body{display:grid;gap:10px;padding:10px}
.row{border:1px solid var(--border);border-radius:10px;background:var(--panel)}
.row.row--placeholder .num{visibility:hidden;background:transparent}
.row .header{display:flex;align-items:flex-start;gap:8px;padding:10px;border-bottom:1px solid var(--border)}
.row .drag-cell{width:28px;display:flex;align-items:center;justify-content:center;flex-shrink:0;order: 2;}
.row .meta{order: 1;}
.drag-handle{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:6px;border:1px solid transparent;background:transparent;color:var(--muted);font-size:14px;cursor:grab;padding:0}
.drag-handle span{pointer-events:none}
.drag-handle--inactive{opacity:.35;cursor:not-allowed;border-color:transparent}
.drag-handle--hidden{opacity:0;pointer-events:none}
.row--draggable .drag-handle{border-color:var(--border);background:var(--panel)}
.row--draggable .drag-handle:hover{background:rgba(148,163,184,0.12)}
.row--draggable .drag-handle:active{cursor:grabbing}
.row.dragging{opacity:.85}
.row.drag-over-before{box-shadow:0 -2px 0 0 var(--accent) inset}
.row.drag-over-after{box-shadow:0 2px 0 0 var(--accent) inset}
.num{min-width: 28px;height: 39px;border-radius:15px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
.header-main{flex:1 1 auto;min-width:0;display:flex;flex-direction:column;gap:2px}
.title-label-row{display:flex;align-items:center;gap:6px;min-width:0}
.title-label{font-weight:700;color:var(--text);min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.title-label.placeholder{color:var(--muted);font-style:italic;font-weight:600}
.geocode-warning{display:none;align-items:center;justify-content:center;color:#dc2626;width:18px;height:18px;margin-left:2px}
.geocode-warning svg{width:18px;height:18px;display:block}
.geocode-warning[data-visible="true"]{display:inline-flex}
.title-city{color:var(--muted);font-size:12px;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.deadline-indicator{width:0;height:0;background-color:var(--deadline-color,currentColor);-webkit-mask:url('../pic/hatarido.svg') center/contain no-repeat;mask:url('../pic/hatarido.svg') center/contain no-repeat;display:inline-flex;flex-shrink:0;opacity:0;transition:opacity .2s ease}
.deadline-indicator[data-visible="true"]{width:var(--deadline-icon-size,16px);height:var(--deadline-icon-size,16px);opacity:1}
.tools{display:flex;gap:6px;align-items:center;   order: 3;}
.iconbtn{border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:8px;padding:4px 8px;cursor:pointer;line-height:1}
.iconbtn:hover{background:rgba(148,163,184,0.12)}
.body{padding:8px;display:grid;gap:6px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:6px}
.f-readonly{display:flex;flex-direction:column;gap:4px}
.f-readonly .readonly-label{font-size:12px;font-weight:600;color:var(--muted)}
.f-readonly .readonly-value{display:block;padding:8px 10px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text);min-height:36px;word-break:break-word;white-space:pre-wrap}
.group-planned-date--readonly,.group-planned-time--readonly{display:flex;gap:8px;align-items:center}
.group-planned-date--readonly .readonly-label,.group-planned-time--readonly .readonly-label{font-size:12px;font-weight:600;color:var(--muted)}
.group-planned-date--readonly .readonly-value,.group-planned-time--readonly .readonly-value{padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text)}
.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:6px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.action-row{margin-top:6px;display:flex;justify-content:flex-end}
.f{display:grid;gap:3px}
.f label{font-size:12px;color:var(--muted)}
.f input,.f select{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--text)}
.select-round{max-width:140px}
.btns{display:flex;gap:8px;align-items:end}
button{appearance:none;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:8px;padding:8px 10px;cursor:pointer}
button.ok{border-color:#c7d2fe;background:rgba(99,102,241,0.12);color:var(--text)}
button.del{border-color:#fecaca;background:rgba(248,113,113,0.12);color:var(--text)}
button.del:disabled{opacity:.5;cursor:not-allowed}
.row.active{outline:2px solid var(--accent)}
.row.highlight{box-shadow:0 0 0 3px var(--highlight) inset}
#map{height:100vh;min-height:240px;width:100%;position:relative;z-index:0;touch-action:pan-x pan-y}

@media (max-width:1100px){
  #map{height:calc(100dvh - var(--mobile-header-height, 0px));}
  .panel-top{margin-bottom:0px !important;}
  .panel-top .quick-search-wrapper{align-items:center;gap:8px}
  .panel-top .quick-search-wrapper .quick-search-form{flex:1 1 auto;min-width:0}
  .panel-top .quick-search-wrapper .view-switch{display:inline-flex}
  .panel-top .quick-search-wrapper .view-switch-btn{width:38px;height:38px;padding:8px}
}
.badge{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:transparent;color:var(--muted);font-size:11px}
.dark #map { filter: none; } /* a térkép csempe marad világos */
input[type="search"]::-webkit-search-decoration,
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-results-button,
input[type="search"]::-webkit-search-results-decoration {  display: none;}
.leaflet-marker-icon.marker-pin-icon{background:transparent;border:none;width:auto!important;height:auto!important;}
.marker-pin-wrapper{position:relative;width:var(--marker-size,38px);height:var(--marker-size,38px);display:inline-block;}
.marker-pin-image{display:block;width:100%;height:100%;pointer-events:none;}
.marker-overlap-badge{position:absolute;top:var(--overlap-offset-y,2.5px);right:var(--overlap-margin-right,1.5px);min-width:var(--overlap-size,16px);height:var(--overlap-size,16px);padding:0 3px;border-radius:var(--overlap-corner-radius,8px);background-color:var(--overlap-bg,rgba(15,23,42,0.92));border:var(--overlap-border-width,0.8px) solid var(--overlap-border,rgba(255,255,255,0.65));color:var(--overlap-text-color,#fff);display:flex;align-items:center;justify-content:center;font-size:var(--overlap-font-size,11px);font-family:var(--overlap-font-family,Arial,Helvetica,sans-serif);font-weight:var(--overlap-font-weight,700);line-height:1;white-space:nowrap;pointer-events:none;box-sizing:border-box;}
#devlogo{width:200px;margin:10px auto;display:flex;opacity: 0.3}
.app-version{padding-bottom: 10px;text-align:center;font-size:12px;color:var(--muted);margin:0 auto 16px;opacity:0.8;}

.change-notice{
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translate(-50%,0);
  display:flex;
  align-items:center;
  gap:12px;
  background:#111827;
  color:#f9fafb;
  padding:10px 16px;
  border-radius:999px;
  box-shadow:0 12px 32px rgba(15,23,42,0.25);
  z-index:11000;
  transition:opacity .25s ease, transform .25s ease;
}
.change-notice--hidden{
  opacity:0;
  pointer-events:none;
  transform:translate(-50%,30px);
}
.change-notice__button{
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:999px;
  padding:6px 14px;
  font-weight:600;
  cursor:pointer;
}
.change-notice__button:hover{filter:brightness(1.05);}

.conflict-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.45);
  backdrop-filter:blur(2px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:12000;
  padding:20px;
}
.conflict-dialog{
  background:var(--panel);
  color:var(--text);
  padding:24px;
  border-radius:16px;
  max-width:520px;
  width:min(520px,90vw);
  box-shadow:0 18px 48px rgba(15,23,42,0.25);
  display:grid;
  gap:16px;
}
.conflict-diff{
  list-style:none;
  margin:0;
  padding:0;
  display:grid;
  gap:8px;
  font-size:14px;
}
.conflict-diff li{
  background:rgba(37,99,235,0.08);
  border-radius:10px;
  padding:8px 10px;
}
.conflict-diff .conflict-before{color:var(--muted);}
.conflict-diff .conflict-after{color:var(--accent);font-weight:600;}
.conflict-diff .conflict-local{color:var(--muted);font-size:12px;margin-left:6px;}
.conflict-actions{display:flex;justify-content:flex-end;gap:10px;}
.conflict-actions button{
  border-radius:999px;
  padding:8px 16px;
  border:1px solid var(--border);
  background:var(--panel);
  font-weight:600;
}
.conflict-actions button.primary{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
.conflict-actions button.primary:hover{filter:brightness(1.05);}

.import-progress-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.35);
  backdrop-filter:blur(4px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:13000;
  padding:24px;
}
.import-progress-overlay__box{
  background:var(--panel);
  color:var(--text);
  padding:28px;
  border-radius:16px;
  box-shadow:0 18px 48px rgba(15,23,42,0.35);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:18px;
  min-width:min(320px,85vw);
}
.import-progress-overlay__spinner{
  width:64px;
  height:64px;
  border-radius:999px;
  border:6px solid rgba(148,163,184,0.35);
  border-top-color:var(--accent);
  animation:import-spin 1s linear infinite;
}
.import-progress-overlay__text{
  font-size:18px;
  font-weight:600;
  text-align:center;
}
@keyframes import-spin{
  to{transform:rotate(360deg);}
}

.import-dialog-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.45);
  backdrop-filter:blur(3px);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  z-index:13500;
}
.import-dialog{
  background:var(--panel);
  color:var(--text);
  padding:28px;
  border-radius:16px;
  box-shadow:0 22px 52px rgba(15,23,42,0.35);
  width:min(520px, 96vw);
  max-height:90vh;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:16px;
}
.import-dialog__text p{
  margin:0;
  font-size:16px;
  line-height:1.5;
}
.import-dialog__list{
  list-style:decimal inside;
  margin:0;
  padding:0;
  display:grid;
  gap:6px;
  font-size:15px;
  max-height:220px;
  overflow:auto;
}
.import-dialog__list li{
  background:rgba(37,99,235,0.08);
  border-radius:10px;
  padding:8px 10px;
}
.import-dialog__actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}
.import-dialog__actions--wrap{
  gap:10px;
}
.import-dialog__actions button{
  border-radius:10px;
  padding:10px 18px;
  font-weight:600;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  cursor:pointer;
}
.import-dialog__actions button.primary{
  background:var(--accent);
  border-color:var(--accent);
  color:#fff;
}
.import-dialog__actions button.secondary{
  background:var(--panel);
  color:var(--text);
}
.import-dialog__actions button.ghost{
  background:transparent;
  color:var(--text);
}
.import-dialog__actions button.danger{
  background:#dc2626;
  border-color:#dc2626;
  color:#fff;
}
.import-dialog__actions button.success{
  background:#16a34a;
  border-color:#16a34a;
  color:#fff;
}
.import-dialog__actions button:disabled{
  opacity:0.65;
  cursor:default;
}
.import-dialog__actions button:hover{filter:brightness(0.98);}
